<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>code position to ast • straw</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="code position to ast">
<meta property="og:description" content="straw">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">straw</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/challenges.html">ast challenges</a>
    </li>
    <li>
      <a href="../articles/code-pos-to-ast.html">code position to ast</a>
    </li>
    <li>
      <a href="../articles/errors.html">errors</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="code-pos-to-ast_files/header-attrs-2.1/header-attrs.js"></script><script src="code-pos-to-ast_files/htmlwidgets-1.5.1/htmlwidgets.js"></script><script src="code-pos-to-ast_files/cytoscape-3.2.19/cytoscape.min.js"></script><script src="code-pos-to-ast_files/dagre-0.8.2/dagre.min.js"></script><script src="code-pos-to-ast_files/cytoscape-dagre-2.2.2/cytoscape-dagre.js"></script><script src="code-pos-to-ast_files/cytoscape_dagre-binding-0.0.1/cytoscape_dagre.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>code position to ast</h1>
            
      
      
      <div class="hidden name"><code>code-pos-to-ast.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw">straw</span>)
</pre></div>
<pre><code>## Loading required package: dplyr</code></pre>
<pre><code>## 
## Attaching package: 'dplyr'</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union</code></pre>
<pre><code>## Loading required package: purrr</code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span>(keep.source = <span class="fl">TRUE</span>)

<span class="kw">expr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/parse.html">parse</a></span>(text = <span class="st">"
function(a = 1) {
  2
  3 + 3
}"</span>)

<span class="kw">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_parse_graph.html">create_parse_graph</a></span>(<span class="kw">expr</span>)
<span class="kw">g_ast</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_parse_graph.html">create_parse_graph</a></span>(<span class="kw">expr</span>, type = <span class="st">'ast'</span>)

<span class="fu"><a href="../reference/cytoscape_dagre.html">cytoscape_dagre</a></span>(<span class="fu">tbl_to_cyto</span>(<span class="kw">g</span>))
</pre></div>
<div id="htmlwidget-07407ab6eee475e894ea" style="width:700px;height:432.632880098888px;" class="cytoscape_dagre html-widget"></div>
<script type="application/json" data-for="htmlwidget-07407ab6eee475e894ea">{"x":{"elements":[{"data":{"line1":null,"col1":null,"line2":null,"col2":null,"id":0,"token":null,"terminal":null,"text":"","row_num":1,"children":2}},{"data":{"line1":2,"col1":1,"line2":5,"col2":1,"id":32,"token":"expr","terminal":false,"text":"","row_num":2,"children":[3,4,5,6,8,9,10]}},{"data":{"line1":2,"col1":1,"line2":2,"col2":8,"id":3,"token":"FUNCTION","terminal":true,"text":"function","row_num":3,"children":[]}},{"data":{"line1":2,"col1":9,"line2":2,"col2":9,"id":4,"token":"'('","terminal":true,"text":"(","row_num":4,"children":[]}},{"data":{"line1":2,"col1":10,"line2":2,"col2":10,"id":5,"token":"SYMBOL_FORMALS","terminal":true,"text":"a","row_num":5,"children":[]}},{"data":{"line1":2,"col1":12,"line2":2,"col2":12,"id":6,"token":"EQ_FORMALS","terminal":true,"text":"=","row_num":6,"children":[]}},{"data":{"line1":2,"col1":14,"line2":2,"col2":14,"id":7,"token":"NUM_CONST","terminal":true,"text":"1","row_num":7,"children":[]}},{"data":{"line1":2,"col1":14,"line2":2,"col2":14,"id":8,"token":"expr","terminal":false,"text":"","row_num":8,"children":7}},{"data":{"line1":2,"col1":15,"line2":2,"col2":15,"id":9,"token":"')'","terminal":true,"text":")","row_num":9,"children":[]}},{"data":{"line1":2,"col1":17,"line2":5,"col2":1,"id":29,"token":"expr","terminal":false,"text":"","row_num":10,"children":[11,13,14,20]}},{"data":{"line1":2,"col1":17,"line2":2,"col2":17,"id":11,"token":"'{'","terminal":true,"text":"{","row_num":11,"children":[]}},{"data":{"line1":3,"col1":3,"line2":3,"col2":3,"id":13,"token":"NUM_CONST","terminal":true,"text":"2","row_num":12,"children":[]}},{"data":{"line1":3,"col1":3,"line2":3,"col2":3,"id":14,"token":"expr","terminal":false,"text":"","row_num":13,"children":12}},{"data":{"line1":4,"col1":3,"line2":4,"col2":7,"id":24,"token":"expr","terminal":false,"text":"","row_num":14,"children":[16,17,19]}},{"data":{"line1":4,"col1":3,"line2":4,"col2":3,"id":18,"token":"NUM_CONST","terminal":true,"text":"3","row_num":15,"children":[]}},{"data":{"line1":4,"col1":3,"line2":4,"col2":3,"id":19,"token":"expr","terminal":false,"text":"","row_num":16,"children":15}},{"data":{"line1":4,"col1":5,"line2":4,"col2":5,"id":20,"token":"'+'","terminal":true,"text":"+","row_num":17,"children":[]}},{"data":{"line1":4,"col1":7,"line2":4,"col2":7,"id":21,"token":"NUM_CONST","terminal":true,"text":"3","row_num":18,"children":[]}},{"data":{"line1":4,"col1":7,"line2":4,"col2":7,"id":22,"token":"expr","terminal":false,"text":"","row_num":19,"children":18}},{"data":{"line1":5,"col1":1,"line2":5,"col2":1,"id":27,"token":"'}'","terminal":true,"text":"}","row_num":20,"children":[]}},{"data":{"source":0,"target":32,"id":"edge-2"}},{"data":{"source":32,"target":3,"id":"edge-3"}},{"data":{"source":32,"target":4,"id":"edge-4"}},{"data":{"source":32,"target":5,"id":"edge-5"}},{"data":{"source":32,"target":6,"id":"edge-6"}},{"data":{"source":8,"target":7,"id":"edge-7"}},{"data":{"source":32,"target":8,"id":"edge-8"}},{"data":{"source":32,"target":9,"id":"edge-9"}},{"data":{"source":32,"target":29,"id":"edge-10"}},{"data":{"source":29,"target":11,"id":"edge-11"}},{"data":{"source":14,"target":13,"id":"edge-12"}},{"data":{"source":29,"target":14,"id":"edge-13"}},{"data":{"source":29,"target":24,"id":"edge-14"}},{"data":{"source":19,"target":18,"id":"edge-15"}},{"data":{"source":24,"target":19,"id":"edge-16"}},{"data":{"source":24,"target":20,"id":"edge-17"}},{"data":{"source":22,"target":21,"id":"edge-18"}},{"data":{"source":24,"target":22,"id":"edge-19"}},{"data":{"source":29,"target":27,"id":"edge-20"}}],"style":null},"evals":[],"jsHooks":[]}</script><div class="sourceCode" id="cb8"><pre class="downlit">
<span class="kw">g</span>
</pre></div>
<pre><code>##     line1 col1 line2 col2 id parent          token terminal     text row_num
## 32     NA   NA    NA   NA  0     NA           &lt;NA&gt;       NA                1
## 321     2    1     5    1 32      0           expr    FALSE                2
## 3       2    1     2    8  3     32       FUNCTION     TRUE function       3
## 4       2    9     2    9  4     32            '('     TRUE        (       4
## 5       2   10     2   10  5     32 SYMBOL_FORMALS     TRUE        a       5
## 6       2   12     2   12  6     32     EQ_FORMALS     TRUE        =       6
## 7       2   14     2   14  7      8      NUM_CONST     TRUE        1       7
## 8       2   14     2   14  8     32           expr    FALSE                8
## 9       2   15     2   15  9     32            ')'     TRUE        )       9
## 29      2   17     5    1 29     32           expr    FALSE               10
## 11      2   17     2   17 11     29            '{'     TRUE        {      11
## 13      3    3     3    3 13     14      NUM_CONST     TRUE        2      12
## 14      3    3     3    3 14     29           expr    FALSE               13
## 24      4    3     4    7 24     29           expr    FALSE               14
## 18      4    3     4    3 18     19      NUM_CONST     TRUE        3      15
## 19      4    3     4    3 19     24           expr    FALSE               16
## 20      4    5     4    5 20     24            '+'     TRUE        +      17
## 21      4    7     4    7 21     22      NUM_CONST     TRUE        3      18
## 22      4    7     4    7 22     24           expr    FALSE               19
## 27      5    1     5    1 27     29            '}'     TRUE        }      20
##                 children
## 32                     2
## 321 3, 4, 5, 6, 8, 9, 10
## 3                       
## 4                       
## 5                       
## 6                       
## 7                       
## 8                      7
## 9                       
## 29        11, 13, 14, 20
## 11                      
## 13                      
## 14                    12
## 24            16, 17, 19
## 18                      
## 19                    15
## 20                      
## 21                      
## 22                    18
## 27</code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="kw">ast</span> <span class="op">&lt;-</span> <span class="fu">enhance_ast</span>(<span class="kw">expr</span>)
<span class="kw">ast</span>
</pre></div>
<pre><code>## # A tibble: 12 x 12
##    node     id parent text  token row_num children line1  col1 line2  col2
##    &lt;lis&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;lgl&gt;   &lt;int&gt; &lt;list&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1 &lt;exp…     1     NA ""    NA          1 &lt;int [1…    NA    NA    NA    NA
##  2 &lt;lan…     2      1 ""    NA          2 &lt;int [3…     2     1     5     1
##  3 &lt;sym&gt;     3      2 "fun… NA          3 &lt;int [0…     2     1     2     8
##  4 &lt;pai…     4      2 ""    NA          4 &lt;int [1…     2     9     2     9
##  5 &lt;dbl…     5      4 "1"   NA          5 &lt;int [0…     2    14     2    14
##  6 &lt;lan…     6      2 ""    NA          6 &lt;int [3…     2    17     5     1
##  7 &lt;sym&gt;     7      6 "{"   NA          7 &lt;int [0…     2    17     2    17
##  8 &lt;dbl…     8      6 "2"   NA          8 &lt;int [0…     3     3     3     3
##  9 &lt;lan…     9      6 ""    NA          9 &lt;int [3…     4     3     4     7
## 10 &lt;sym&gt;    10      9 "+"   NA         10 &lt;int [0…     4     5     4     5
## 11 &lt;dbl…    11      9 "3"   NA         11 &lt;int [0…     4     3     4     3
## 12 &lt;dbl…    12      9 "3"   NA         12 &lt;int [0…     4     7     4     7
## # … with 1 more variable: parse_row_num &lt;int&gt;</code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="kw">find_code</span> <span class="op">&lt;-</span> <span class="fu">function</span> (<span class="kw">enhanced_ast</span>, <span class="kw">line1</span>, <span class="kw">col1</span>, <span class="kw">line2</span>, <span class="kw">col2</span>) {
  <span class="kw">code</span> <span class="op">&lt;-</span> <span class="kw">enhanced_ast</span>[<span class="op">-</span><span class="fl">1</span>,]
  <span class="kw">indx</span> <span class="op">&lt;-</span> (
    <span class="kw">code</span><span class="op">$</span><span class="kw">line1</span> <span class="op">&lt;=</span> <span class="kw">line1</span> <span class="op">&amp;</span> <span class="kw">code</span><span class="op">$</span><span class="kw">line2</span> <span class="op">&gt;=</span> <span class="kw">line2</span> <span class="op">&amp;</span>
    <span class="kw">code</span><span class="op">$</span><span class="kw">col1</span> <span class="op">&lt;=</span> <span class="kw">col1</span> <span class="op">&amp;</span> <span class="kw">code</span><span class="op">$</span><span class="kw">col2</span> <span class="op">&gt;=</span> <span class="kw">col2</span>
    )
  
  <span class="kw">rects</span> <span class="op">&lt;-</span> <span class="kw">code</span>[<span class="kw">indx</span>,]
  
  <span class="co">if</span> (<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="kw">rects</span>) <span class="op">==</span> <span class="fl">1</span>)
    <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="kw">rects</span>)
  
  <span class="co"># find smallest bounding rectangle</span>
  <span class="kw">min_indx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span>(<span class="kw">rects</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span>(<span class="kw">line1</span> <span class="op">*</span> <span class="kw">line2</span> <span class="op">*</span> <span class="kw">col1</span> <span class="op">*</span> <span class="kw">col2</span>))
  <span class="kw">rects</span>[<span class="kw">min_indx</span>,]
}

<span class="co"># find the smallest bounded rectangle</span>
<span class="co"># line: 4, 4    column: 3, 3</span>
<span class="fu">find_code</span>(<span class="kw">ast</span>, <span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">3</span>)[,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>,<span class="fl">3</span>)]
</pre></div>
<pre><code>## # A tibble: 1 x 10
##   node      text  token row_num children  line1  col1 line2  col2 parse_row_num
##   &lt;list&gt;    &lt;chr&gt; &lt;lgl&gt;   &lt;int&gt; &lt;list&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;         &lt;int&gt;
## 1 &lt;dbl [1]&gt; 3     NA         11 &lt;int [0]&gt;     4     3     4     3            16</code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="fu">find_code</span>(<span class="kw">ast</span>, <span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>)[,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>,<span class="fl">3</span>)]
</pre></div>
<pre><code>## # A tibble: 1 x 10
##   node       text  token row_num children  line1  col1 line2  col2 parse_row_num
##   &lt;list&gt;     &lt;chr&gt; &lt;lgl&gt;   &lt;int&gt; &lt;list&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;         &lt;int&gt;
## 1 &lt;language&gt; ""    NA          9 &lt;int [3]&gt;     4     3     4     7            14</code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit">
<span class="kw">expr2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/parse.html">parse</a></span>(text = <span class="st">"
{
  3 + 3
}
"</span>)

<span class="kw">ast</span> <span class="op">&lt;-</span> <span class="fu">enhance_ast</span>(<span class="kw">expr2</span>)
<span class="fu">find_code</span>(<span class="kw">ast</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">4</span>)
</pre></div>
<pre><code>## # A tibble: 1 x 12
##   node     id parent text  token row_num children line1  col1 line2  col2
##   &lt;lis&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;lgl&gt;   &lt;int&gt; &lt;list&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1 &lt;lan…     4      2 ""    NA          4 &lt;int [3…     3     3     3     7
## # … with 1 more variable: parse_row_num &lt;int&gt;</code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit">
<span class="kw">ast</span>
</pre></div>
<pre><code>## # A tibble: 7 x 12
##   node     id parent text  token row_num children line1  col1 line2  col2
##   &lt;lis&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;lgl&gt;   &lt;int&gt; &lt;list&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1 &lt;exp…     1     NA ""    NA          1 &lt;int [1…    NA    NA    NA    NA
## 2 &lt;lan…     2      1 ""    NA          2 &lt;int [2…     2     1     4     1
## 3 &lt;sym&gt;     3      2 "{"   NA          3 &lt;int [0…     2     1     2     1
## 4 &lt;lan…     4      2 ""    NA          4 &lt;int [3…     3     3     3     7
## 5 &lt;sym&gt;     5      4 "+"   NA          5 &lt;int [0…     3     5     3     5
## 6 &lt;dbl…     6      4 "3"   NA          6 &lt;int [0…     3     3     3     3
## 7 &lt;dbl…     7      4 "3"   NA          7 &lt;int [0…     3     7     3     7
## # … with 1 more variable: parse_row_num &lt;int&gt;</code></pre>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Michael Chow.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.0.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
